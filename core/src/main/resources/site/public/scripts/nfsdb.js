/*******************************************************************************
 *  _  _ ___ ___     _ _
 * | \| | __/ __| __| | |__
 * | .` | _|\__ \/ _` | '_ \
 * |_|\_|_| |___/\__,_|_.__/
 *
 * Copyright (c) 2014-2016. The NFSdb project and its contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

"use strict";function s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}function numberWithCommas(e){return 1024>e?e:1048576>e?Math.round(e/1024)+"KB":1073741824>e?Math.round(e/1024/1024)+"MB":Math.round(e/1024/1024/1024)+"GB"}function nopropagation(e){e.stopPropagation(),e.preventDefault&&e.preventDefault()}function localStorageSupport(){return"localStorage"in window&&null!==window.localStorage}function fixHeight(){var e=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",e+"px");var a=$("nav.navbar-default").height(),s=$("#page-wrapper"),i=s.height();a>i&&s.css("min-height",a+"px"),i>a&&s.css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")&&(a>i?s.css("min-height",a-60+"px"):s.css("min-height",$(window).height()-60+"px"))}!function(e){e.fn.importManager=function(){function a(){var a=e(this).parent().attr("id"),s=e("#"+a).find(".fa"),i=u[a];i.selected=!i.selected,i.selected?s.removeClass("fa-square-o").addClass("fa-check-square-o"):s.removeClass("fa-check-square-o").addClass("fa-square-o")}function s(a){var s=e(this).parent().attr("id");e("#upload-detail").html(u[s].response.location),nopropagation(a)}function i(i){c.append('<div id="'+i.id+'" class="ud-row" style="top: '+g+'px;"><div class="ud-cell ud-c0"><i class="fa fa-square-o"></i></div><div class="ud-cell ud-c1">'+i.name+'</div><div class="ud-cell ud-c2">'+i.sizeFmt+'</div><div class="ud-cell ud-c3"><span class="label">pending</span></div></div>');var t=e("#"+i.id);t.find(".ud-c0").click(a),t.find(".ud-c1").click(s),t.find(".ud-c2").click(s),t.find(".ud-c3").click(s),g+=m}function t(a){if(a.lengthComputable){var s=a.loaded||a.position;e("#"+h.id).find(" > .ud-progress").css("width",100*s/h.size+"%")}}function o(a,s,i){var t=e("#"+a.id);if(t.find(" > .ud-c3").html(s),t.find(" > .ud-progress").remove(),i){var o=p.shift();o?r(o):h=null}}function n(){var a=e.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",t,!1),a}function l(e){h.response=e,o(h,'<span class="label label-success">success</span>',!0)}function d(e){h.response=e.responseText,o(h,'<span class="label label-danger">failed</span>',!0)}function r(a){h=a,o(a,'<span class="label label-info">importing</span>',!1),e("#"+a.id).append('<div class="ud-progress"></div>'),v.data=new FormData,v.data.append("data",a.file),e.ajax(v)}var c,u={},f=this,g=0,p=[],h=null,m=35,v={xhr:n,url:"/imp?fmt=json",type:"POST",contentType:!1,processData:!1,cache:!1,success:l,error:d};return f.append('<div class="ud-header-row"><div class="ud-header ud-h0">&nbsp;</div><div class="ud-header ud-h1">File name</div><div class="ud-header ud-h2">Size</div><div class="ud-header ud-h3">Status</div></div>'),f.append('<div class="ud-canvas"></div>'),c=f.find("> .ud-canvas"),e(document).on("dropbox.files",function(e,a){for(var s=0;s<a.files.length;s++){var t=a.files[s],o={id:guid(),name:t.name,size:t.size,file:t,sizeFmt:numberWithCommas(t.size),selected:!1};u[o.id]=o,i(o),null!=h?p.push(o):r(o)}}),e(document).on("import.clearSelected",function(){for(var a in u)u.hasOwnProperty(a)&&u[a].selected&&(e("#"+a).remove(),delete u[a]);g=0;for(var s=c.find(".ud-row"),i=0;i<s.length;i++)e(s[i]).css("top",g),g+=m}),this},e.fn.dropbox=function(){function a(){o.addClass("drag-drop").removeClass("drag-idle")}function s(){o.removeClass("drag-drop").addClass("drag-idle")}function i(){o.on("drop",function(a){s(),t=e(),e(document).trigger("dropbox.files",a.originalEvent.dataTransfer)}),o.each(function(){var i=e(this);i.on("dragenter",function(e){0===t.size()&&(nopropagation(e),a()),t=t.add(e.target)}),i.on("dragleave",function(e){setTimeout(function(){t=t.not(e.target),0===t.size()&&s()},1)})})}var t=e(),o=this;return i(),this}}(jQuery),$(document).ready(function(){$("#btnClearSelected").click(function(){$(document).trigger("import.clearSelected")}),$("#btnRetry").click(function(){$(document).trigger("import.retry")}),$("#dragTarget").dropbox(),$("#import-file-list").importManager(),$(document).on("dragenter",nopropagation),$(document).on("dragover",nopropagation),$(document).on("drop",nopropagation)}),$(document).ready(function(){for(var e=["INT","STRING","DOUBLE"],a=$('<select class="g-dynamic-select form-control m-b"/>'),s=0;s<e.length;s++){var i=e[s];$("<option />",{value:i,text:i}).appendTo(a)}$(".g-type").click(function(){var e=$(this);a.appendTo(e.parent()),a.css("display","block"),a.css("left",e.css("left")),a.css("width",e.css("width")),a.val(e.text()),a.changeTarget=e,a.focus()}),$(".g-other").click(function(){a.css("display","none")}),a.change(function(){a.changeTarget.html($(this).find("option:selected").text()),a.css("display","none")});var t=$(".stats-switcher");$(".import-stats-chart").click(function(){t.hasClass("stats-visible")?t.removeClass("stats-visible"):t.addClass("stats-visible")})}),function(e){function a(){function a(){}function s(){null!==r&&(r.abort(),r=null)}function i(){null!==c&&(clearTimeout(c),c=null)}function t(){console.log("success")}function o(e,a){console.log("not so lucky: "+a)}function n(){s(),u.query=d,u.limit="0,100",u.withCount=!0,r=e.get("/js",u,t,o)}function l(e){d=e,i(),setTimeout(n,50)}var d,r=null,c=null,u={query:"",limit:"",withCount:!1};return a(),{sendQuery:l}}e.extend(!0,window,{nfsdb:{GridController:a}})}(jQuery),$(document).ready(function(){function e(){var e=$("body");!e.hasClass("mini-navbar")||e.hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},200)):e.hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},100)):$("#side-menu").removeAttr("style")}$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small"),$("#side-menu").metisMenu(),$(".collapse-link").click(function(){var e=$(this).closest("div.ibox"),a=$(this).find("i"),s=e.find("div.ibox-content");s.slideToggle(200),a.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),e.toggleClass("").toggleClass("border-bottom"),setTimeout(function(){e.resize(),e.find("[id^=map-]").resize()},50)}),$(".close-link").click(function(){var e=$(this).closest("div.ibox");e.remove()}),$(".fullscreen-link").click(function(){var e=$(this).closest("div.ibox"),a=$(this).find("i");$("body").toggleClass("fullscreen-ibox-mode"),a.toggleClass("fa-expand").toggleClass("fa-compress"),e.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}),$(".close-canvas-menu").click(function(){$("body").toggleClass("mini-navbar"),e()}),$("body.canvas-menu .sidebar-collapse").slimScroll({height:"100%",railOpacity:.9}),$(".right-sidebar-toggle").click(function(){$("#right-sidebar").toggleClass("sidebar-open")}),$(".sidebar-container").slimScroll({height:"100%",railOpacity:.4,wheelStep:10}),$(".open-small-chat").click(function(){$(this).children().toggleClass("fa-comments").toggleClass("fa-remove"),$(".small-chat-box").toggleClass("active")}),$(".small-chat-box .content").slimScroll({height:"234px",railOpacity:.4}),$(".check-link").click(function(){var e=$(this).find("i"),a=$(this).next("span");return e.toggleClass("fa-check-square").toggleClass("fa-square-o"),a.toggleClass("todo-completed"),!1}),$(".navbar-minimalize").click(function(){$("body").toggleClass("mini-navbar"),e()}),$(".tooltip-demo").tooltip({selector:"[data-toggle=tooltip]",container:"body"}),$(".modal").appendTo("body"),fixHeight(),$(window).bind("load",function(){$("body").hasClass("fixed-sidebar")&&$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:.9})}),$(window).scroll(function(){$(window).scrollTop()>0&&!$("body").hasClass("fixed-nav")?$("#right-sidebar").addClass("sidebar-top"):$("#right-sidebar").removeClass("sidebar-top")}),$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||fixHeight()}),$("[data-toggle=popover]").popover(),$("[data-toggle=tooltip]").tooltip(),$(".full-height-scroll").slimscroll({height:"100%"})}),$(window).bind("resize",function(){$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")}),$(document).ready(function(){if(localStorageSupport){var e=localStorage.getItem("collapse_menu"),a=localStorage.getItem("fixedsidebar"),s=localStorage.getItem("fixednavbar"),i=localStorage.getItem("boxedlayout"),t=localStorage.getItem("fixedfooter"),o=$("body");"on"===a&&(o.addClass("fixed-sidebar"),$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:.9})),"on"===e&&(o.hasClass("fixed-sidebar")?o.hasClass("body-small")||o.addClass("mini-navbar"):o.hasClass("body-small")||o.addClass("mini-navbar")),"on"===s&&($(".navbar-static-top").removeClass("navbar-static-top").addClass("navbar-fixed-top"),o.addClass("fixed-nav")),"on"===i&&o.addClass("boxed-layout"),"on"===t&&$(".footer").addClass("fixed")}}),$(document).ready(function(){var e=$(".sql-editor"),a=$(".file-upload");$("a#sql-editor").click(function(){e.css("display","block"),a.css("display","none"),$("#sqlEditor").css("height","240px")}),$("a#file-upload").click(function(){e.css("display","none"),a.css("display","block")});var s=ace.edit("sqlEditor");s.getSession().setMode("ace/mode/sql"),s.setTheme("ace/theme/merbivore_soft"),s.setShowPrintMargin(!1),s.setDisplayIndentGuides(!1),s.setHighlightActiveLine(!1),"undefined"!=typeof Storage&&localStorage.getItem("lastQuery")&&s.setValue(localStorage.getItem("lastQuery")),s.focus();var i=$("#grid");i.css("height","430px");var t=new Slick.Grid(i,[],[],{enableCellNavigation:!0,enableColumnReorder:!1,enableTextSelectionOnCells:!0});t.resizeCanvas()});