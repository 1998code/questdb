/*******************************************************************************
 *  _  _ ___ ___     _ _
 * | \| | __/ __| __| | |__
 * | .` | _|\__ \/ _` | '_ \
 * |_|\_|_| |___/\__,_|_.__/
 *
 * Copyright (c) 2014-2016. The NFSdb project and its contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

"use strict";function s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}function numberWithCommas(e){return 1024>e?e:1048576>e?Math.round(e/1024)+"KB":1073741824>e?Math.round(e/1024/1024)+"MB":Math.round(e/1024/1024/1024)+"GB"}function nopropagation(e){e.stopPropagation(),e.preventDefault&&e.preventDefault()}function localStorageSupport(){return"localStorage"in window&&null!==window.localStorage}function fixHeight(){var e=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",e+"px");var a=$("nav.navbar-default").height(),i=$("#page-wrapper"),s=i.height();a>s&&i.css("min-height",a+"px"),s>a&&i.css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")&&(a>s?i.css("min-height",a-60+"px"):i.css("min-height",$(window).height()-60+"px"))}!function(e){e.fn.importManager=function(){function a(){var a=e(this).parent().attr("id"),i=e("#"+a).find(".fa"),s=g[a];s.selected=!s.selected,s.selected?(i.removeClass("fa-square-o"),i.addClass("fa-check-square-o")):(i.removeClass("fa-check-square-o"),i.addClass("fa-square-o"))}function i(a){var i=e(this).parent().attr("id");e("#upload-detail").html(g[i].response),nopropagation(a)}function s(s){u.append('<div id="'+s.id+'" class="ud-row" style="top: '+p+'px;"><div class="ud-cell ud-c0"><i class="fa fa-square-o"></i></div><div class="ud-cell ud-c1">'+s.name+'</div><div class="ud-cell ud-c2">'+s.sizeFmt+'</div><div class="ud-cell ud-c3"><span class="label">pending</span></div></div>');var o=e("#"+s.id);o.find(".ud-c0").click(a),o.find(".ud-c1").click(i),o.find(".ud-c2").click(i),o.find(".ud-c3").click(i),p+=35}function o(a){if(a.lengthComputable){var i=a.loaded||a.position;e("#"+m.id).find(" > .ud-progress").css("width",100*i/m.size+"%")}}function n(a,i,s){var o=e("#"+a.id);if(o.find(" > .ud-c3").html(i),o.find(" > .ud-progress").remove(),s){var n=h.shift();n?r(n):m=null}}function t(){var a=e.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener("progress",o,!1),a}function l(e){m.response=e,n(m,'<span class="label label-success">success</span>',!0)}function d(e){m.response=e.responseText,n(m,'<span class="label label-danger">failed</span>',!0)}function r(a){m=a,n(a,'<span class="label label-info">importing</span>',!1),e("#"+a.id).append('<div class="ud-progress"></div>'),v.data=new FormData,v.data.append("data",a.file),e.ajax(v)}function c(e){for(var a=0;a<e.length;a++){var i=e[a],o={id:guid(),name:i.name,size:i.size,file:i,sizeFmt:numberWithCommas(i.size),selected:!1};g[o.id]=o,s(o),null!=m?h.push(o):r(o)}}var u,g={},f=this,p=0,h=[],m=null,v={xhr:t,url:"/imp",type:"POST",contentType:!1,processData:!1,cache:!1,success:l,error:d};return f.append('<div class="ud-header-row"><div class="ud-header ud-h0">&nbsp;</div><div class="ud-header ud-h1">File name</div><div class="ud-header ud-h2">Size</div><div class="ud-header ud-h3">Status</div></div>'),f.append('<div class="ud-canvas"></div>'),u=f.find("> .ud-canvas"),e(document).on("dropbox.files",function(e,a){c(a.files)}),this},e.fn.dropbox=function(){function a(){n.addClass("drag-drop").removeClass("drag-idle")}function i(){n.removeClass("drag-drop").addClass("drag-idle")}function s(){n.on("drop",function(a){i(),o=e(),e(document).trigger("dropbox.files",a.originalEvent.dataTransfer)}),n.each(function(){var s=e(this);s.on("dragenter",function(e){0===o.size()&&(nopropagation(e),a()),o=o.add(e.target)}),s.on("dragleave",function(e){setTimeout(function(){o=o.not(e.target),0===o.size()&&i()},1)})})}var o=e(),n=this;return s(),this}}(jQuery),$(document).ready(function(){$("#dragTarget").dropbox(),$("#upload-list").importManager(),$(document).on("dragenter",nopropagation),$(document).on("dragover",nopropagation),$(document).on("drop",nopropagation)}),function(e){function a(){function a(){}function i(){null!==r&&(r.abort(),r=null)}function s(){null!==c&&(clearTimeout(c),c=null)}function o(){console.log("success")}function n(e,a){console.log("not so lucky: "+a)}function t(){i(),u.query=d,u.limit="0,100",u.withCount=!0,r=e.get("/js",u,o,n)}function l(e){d=e,s(),setTimeout(t,50)}var d,r=null,c=null,u={query:"",limit:"",withCount:!1};return a(),{sendQuery:l}}e.extend(!0,window,{nfsdb:{GridController:a}})}(jQuery),$(document).ready(function(){function e(){var e=$("body");!e.hasClass("mini-navbar")||e.hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},200)):e.hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},100)):$("#side-menu").removeAttr("style")}$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small"),$("#side-menu").metisMenu(),$(".collapse-link").click(function(){var e=$(this).closest("div.ibox"),a=$(this).find("i"),i=e.find("div.ibox-content");i.slideToggle(200),a.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),e.toggleClass("").toggleClass("border-bottom"),setTimeout(function(){e.resize(),e.find("[id^=map-]").resize()},50)}),$(".close-link").click(function(){var e=$(this).closest("div.ibox");e.remove()}),$(".fullscreen-link").click(function(){var e=$(this).closest("div.ibox"),a=$(this).find("i");$("body").toggleClass("fullscreen-ibox-mode"),a.toggleClass("fa-expand").toggleClass("fa-compress"),e.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}),$(".close-canvas-menu").click(function(){$("body").toggleClass("mini-navbar"),e()}),$("body.canvas-menu .sidebar-collapse").slimScroll({height:"100%",railOpacity:.9}),$(".right-sidebar-toggle").click(function(){$("#right-sidebar").toggleClass("sidebar-open")}),$(".sidebar-container").slimScroll({height:"100%",railOpacity:.4,wheelStep:10}),$(".open-small-chat").click(function(){$(this).children().toggleClass("fa-comments").toggleClass("fa-remove"),$(".small-chat-box").toggleClass("active")}),$(".small-chat-box .content").slimScroll({height:"234px",railOpacity:.4}),$(".check-link").click(function(){var e=$(this).find("i"),a=$(this).next("span");return e.toggleClass("fa-check-square").toggleClass("fa-square-o"),a.toggleClass("todo-completed"),!1}),$(".navbar-minimalize").click(function(){$("body").toggleClass("mini-navbar"),e()}),$(".tooltip-demo").tooltip({selector:"[data-toggle=tooltip]",container:"body"}),$(".modal").appendTo("body"),fixHeight(),$(window).bind("load",function(){$("body").hasClass("fixed-sidebar")&&$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:.9})}),$(window).scroll(function(){$(window).scrollTop()>0&&!$("body").hasClass("fixed-nav")?$("#right-sidebar").addClass("sidebar-top"):$("#right-sidebar").removeClass("sidebar-top")}),$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||fixHeight()}),$("[data-toggle=popover]").popover(),$("[data-toggle=tooltip]").tooltip(),$(".full-height-scroll").slimscroll({height:"100%"})}),$(window).bind("resize",function(){$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")}),$(document).ready(function(){if(localStorageSupport){var e=localStorage.getItem("collapse_menu"),a=localStorage.getItem("fixedsidebar"),i=localStorage.getItem("fixednavbar"),s=localStorage.getItem("boxedlayout"),o=localStorage.getItem("fixedfooter"),n=$("body");"on"===a&&(n.addClass("fixed-sidebar"),$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:.9})),"on"===e&&(n.hasClass("fixed-sidebar")?n.hasClass("body-small")||n.addClass("mini-navbar"):n.hasClass("body-small")||n.addClass("mini-navbar")),"on"===i&&($(".navbar-static-top").removeClass("navbar-static-top").addClass("navbar-fixed-top"),n.addClass("fixed-nav")),"on"===s&&n.addClass("boxed-layout"),"on"===o&&$(".footer").addClass("fixed")}}),$(document).ready(function(){var e=$(".sql-editor"),a=$(".file-upload");$("a#sql-editor").click(function(){e.css("display","block"),a.css("display","none"),$("#sqlEditor").css("height","240px")}),$("a#file-upload").click(function(){e.css("display","none"),a.css("display","block")});var i=ace.edit("sqlEditor");i.getSession().setMode("ace/mode/sql"),i.setTheme("ace/theme/merbivore_soft"),i.setShowPrintMargin(!1),i.setDisplayIndentGuides(!1),i.setHighlightActiveLine(!1),"undefined"!=typeof Storage&&localStorage.getItem("lastQuery")&&i.setValue(localStorage.getItem("lastQuery")),i.focus();var s=$("#grid");s.css("height","430px");var o=new Slick.Grid(s,[],[],{enableCellNavigation:!0,enableColumnReorder:!1,enableTextSelectionOnCells:!0});o.resizeCanvas()});